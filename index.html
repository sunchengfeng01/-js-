<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <title>React App</title>

    <link rel="stylesheet" href="index.css" />
</head>

<body>
    <div id="root">
        <div class="todo-container">
            <div class="todo-wrap">
                <div class="todo-header">
                    <input type="text" placeholder="请输入你的任务名称，按回车键确认" />
                </div>
                <ul class="todo-main">

                </ul>
                <div class="todo-footer">
                    <label>
              <input type="checkbox" />
            </label>
                    <span> <span>已完成0</span> / 全部2 </span>
                    <button class="btn btn-danger">清除已完成任务</button>
                </div>
            </div>
        </div>
    </div>
    <script>
        //获取ul标签
        let oUl = document.querySelector('.todo-main')
        let flag = false;
        // console.log(oUl);
        oUl.innerHTML = `  <li>
                        <label>
                <input type="checkbox" />
                <span>xxxxx</span>
              </label>
                        <button class="btn btn-danger">删除</button>
                    </li>
                    <li>
                        <label>
                <input type="checkbox" />
                <span>yyyy</span>
              </label>
                        <button class="btn btn-danger">删除</button>
                    </li>`
            //获取输入框对象
        let oInput = document.querySelector('.todo-header input')
            // console.log(oInput);
        oInput.onkeydown = (e) => {
            let str = oInput.value.trim();
            // !flag;
            if (e.keyCode === 13) {
                if (!str) {
                    alert('非法字符')
                    return
                }
                //动态添加li标签
                let newLi = document.createElement('li')
                newLi.innerHTML = `<label>
                <input type="checkbox" />
                <span>` + str + `</span>
                </label>
                <button class="btn btn-danger">删除</button>`
                    //获取ul
                let oUl = document.querySelector('.todo-main')
                oUl.appendChild(newLi)
                oInput.value = ''
            }
            oText()
            clearTask()
            removeLi()
            oAllchecked()
        }

        function removeLi() {
            /*
             *给所有的li里面的按键绑定点击事件
             *
             *
             */
            let oUl = document.querySelector('.todo-main')
            let oLi = oUl.querySelectorAll('li')


            oLi.forEach((item, index) => {
                item.onclick = function(e) {

                    let oBtn = this.querySelector('.btn') //变量的不清晰
                        //有一个隐藏属性checked 默认值为false未选中状态
                    let oInput = this.querySelector('input')
                    if (e.target === oBtn && oInput.checked === true) {
                        //删除li
                        oBtn.parentNode.remove()
                    }
                    allfinish()
                    everyChecked()
                    oText()
                }

            })
            everyChecked()

        }
        removeLi()

        function oAllchecked() { //重新获取
            let oAllinput = document.querySelector('.todo-footer input')
            let oAllchecked = document.querySelectorAll('.todo-main li input')
            oAllinput.onclick = () => {
                //不可以是·=赋值操作·，下去就会直接赋值卡死
                if (oAllinput.checked === true) {
                    oAllchecked.forEach((item) => {
                        item.checked = true
                    })
                }
                if (oAllinput.checked === false) {
                    oAllchecked.forEach((item) => {
                        item.checked = false
                    })
                }
                clearTask()
                oText()
            }
        }
        oAllchecked()

        /*
         *单个全选
         *
         *
         */
        everyChecked()

        function everyChecked() {
            let oAllchecked = document.querySelectorAll('.todo-main li input')

            let oAllinput = document.querySelector('.todo-footer input')
            let oAllcheckedArray = Array.from(oAllchecked)
                //通过数组方法进行筛选条件
            let result = oAllcheckedArray.every(function(item, index) {
                return item.checked === true
            })
            if (result) {
                oAllinput.checked = true
            } else {
                oAllinput.checked = false

            }
            oText()
        }


        /*
         *清除已完成任务
         *
         *
         */
        function clearTask() {
            let oclearTask = document.querySelector('.todo-footer .btn')
            oclearTask.onclick = () => {
                //获取选中的
                let oAllchecked = document.querySelectorAll('.todo-main li input')
                oAllchecked.forEach((item) => {


                    if (item.checked === true) {
                        item.parentNode.parentNode.remove()
                    }

                })

                //重新获取，判断li是否有 如果没有则把全选盒子取消
                oAllchecked = document.querySelectorAll('.todo-main li input')
                    // console.log(oAllchecked.length);
                if (!oAllchecked.length) {
                    let oAllinput = document.querySelector('.todo-footer input')
                    oAllinput.checked = false
                        // alert('giaogiaogiao')
                }
                oText()
                allfinish()
            }

        }
        clearTask()

        /*
         *获取标签并且改变内容
         *
         *
         */
        function oText() {
            let oAllTex = document.querySelector('.todo-footer>span')
            let oAllchecked = document.querySelectorAll('.todo-main li input')
            let count = 0
            oAllchecked.forEach((item) => {
                if (item.checked) {
                    count++
                }
            })
            oAllTex.textContent = ' 已完成' + count + ' / 全部' + oAllchecked.length
        }
        oText()

        function allfinish() {
            let oTodomain = document.getElementsByClassName('todo-main')[0]
            let oTodofooter = document.getElementsByClassName('todo-footer')[0]
            let oLi = oTodomain.getElementsByTagName('li')
            let oInput = document.querySelector('.todo-header input')
            if (flag) {
                return
            }
            if (oLi.length === 0) {
                oTodomain.style.display = 'none'
                oTodofooter.style.display = 'none'
                let otodowrap = document.getElementsByClassName('todo-wrap')[0]
                let newDiv = document.createElement('div')
                newDiv.innerText = '今天任务已完成'
                newDiv.style.textAlign = 'center'
                newDiv.style.color = 'red'
                otodowrap.appendChild(newDiv)
            }


        }
    </script>
</body>

</html>